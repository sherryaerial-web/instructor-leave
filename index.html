<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sherry Aerial Studio | æ•™å¸«è«‹å‡ç³»çµ±</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
  
  <style>
    :root {
      --primary-color: #607d8b;
      --bg-color: #f7f9fb;
      --text-main: #455a64; /* æ·±çŸ³æ¿ç° */
      --text-sub: #90a4ae;
      --card-bg: #ffffff;
      --border-color: #cfd8dc;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body { 
      /* å„ªå…ˆèª¿ç”¨ Apple èˆ‡ç¾ä»£è‹±æ–‡å­—é«” */
      font-family: "SF Pro Display", "SF Pro TC", "Helvetica Neue", "Inter", "Noto Sans TC", sans-serif; 
      margin: 0; background: var(--bg-color); color: var(--text-main); 
    }

    /* æ¨™é¡Œå€åŸŸå„ªåŒ– */
    .header { text-align: center; padding: 50px 20px 30px; }
    .header .brand-en { 
      display: block; 
      font-size: 28px; 
      font-weight: 800; 
      letter-spacing: -0.5px; 
      color: var(--primary-color);
      margin-bottom: 4px;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; /* ç¢ºä¿è‹±æ–‡å„ªé›… */
    }
    .header .brand-zh { 
      font-size: 18px; 
      font-weight: 500; 
      color: var(--text-sub); 
      letter-spacing: 2px;
    }

    .wrap { max-width: 500px; margin: 0 auto; padding: 15px; }

    .card { 
      background: var(--card-bg); border-radius: 24px; 
      padding: 26px; margin-bottom: 18px; 
      box-shadow: 0 8px 24px rgba(144, 164, 174, 0.12);
      border: 1px solid rgba(207, 216, 220, 0.5);
    }
    label { display: block; font-weight: 700; margin-bottom: 18px; font-size: 16px; color: var(--primary-color); }

    select { 
      width: 100%; font-size: 16px; padding: 15px; border-radius: 14px; 
      border: 1.5px solid var(--border-color); background: #fff; 
      color: var(--text-main); outline: none; appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2390a4ae' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 14px center;
    }

    .date-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 10px; }
    .date-item { 
      border: 1.5px solid var(--border-color); padding: 14px 5px; border-radius: 16px; 
      text-align: center; cursor: pointer; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      background: #fff; 
    }
    .date-item .day-name { font-size: 11px; font-weight: 700; color: var(--text-sub); display: block; margin-bottom: 4px; }
    .date-item .date-val { font-size: 14px; font-weight: 600; color: var(--text-main); }
    .date-item.active { background: var(--primary-color); border-color: var(--primary-color); transform: translateY(-2px); }
    .date-item.active .day-name, .date-item.active .date-val { color: #fff; }

    .list { display: grid; gap: 12px; }
    .item { 
      display: flex; gap: 16px; border: 1.5px solid #eceff1; padding: 22px; 
      border-radius: 18px; align-items: flex-start; cursor: pointer; transition: 0.2s; 
    }
    .item:hover { border-color: var(--primary-color); background: #fcfdfe; }
    .item input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--primary-color); margin-top: 2px; flex-shrink: 0; }
    .item-meta { font-size: 13px; color: var(--text-sub); font-weight: 500; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
    .item-title { font-size: 18px; font-weight: 700; color: var(--text-main); line-height: 1.4; }

    button#submit { 
      width: 100%; font-size: 17px; font-weight: 700; padding: 20px; border-radius: 18px; 
      border: 0; background: var(--primary-color); color: #fff; cursor: pointer; 
      transition: all 0.3s; margin-top: 10px; 
    }
    button#submit:disabled { background: #cfd8dc; cursor: not-allowed; }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(69, 90, 100, 0.3); backdrop-filter: blur(6px); display: none; justify-content: center; align-items: center; z-index: 9999; padding: 20px; }
    .modal { background: #fff; padding: 45px 30px; border-radius: 32px; max-width: 320px; width: 100%; text-align: center; }
    .modal-btn { background: var(--primary-color); color: #fff; border: 0; width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; cursor: pointer; margin-top: 25px; }
    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 8888; color: var(--primary-color); font-weight: 600; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div id="loading" class="loading-overlay">
  <div style="width:35px; height:35px; border:3.5px solid #eceff1; border-top-color:var(--primary-color); border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:16px;"></div>
  <div>Connecting Sherry Aerial...</div>
</div>

<div id="modalOverlay" class="modal-overlay">
  <div class="modal">
    <span style="font-size:55px; display:block; margin-bottom:15px;">âœ¨</span>
    <div style="font-size: 22px; font-weight: 700; margin-bottom: 12px; color: var(--text-main);">å·²æ”¶åˆ°æ‚¨çš„ç”³è«‹</div>
    <div style="color: var(--text-sub); line-height: 1.6; font-size: 15px;">è«‹å‡ç´€éŒ„å·²åŒæ­¥æ›´æ–°ã€‚</div>
    <button class="modal-btn" onclick="location.reload()">å¥½çš„</button>
  </div>
</div>

<div class="header">
  <span class="brand-en">Sherry Aerial Studio</span>
  <span class="brand-zh">æ•™å¸«è«‹å‡ç³»çµ±</span>
</div>

<div class="wrap">
  <div class="card"><label>1. è«‹é¸æ“‡æ‚¨çš„å§“å</label><select id="instructor"><option value="">è®€å–ä¸­...</option></select></div>
  <div class="card"><label>2. é¸æ“‡è«‹å‡æ—¥æœŸ</label><div id="dateGrid" class="date-grid"></div></div>
  <div id="courseCard" class="card" style="display:none;"><label>3. å‹¾é¸æ¬²è«‹å‡çš„èª²å ‚</label><div id="classList" class="list"></div></div>
  <button id="submit" disabled>ç¢ºèªé€å‡º</button>
</div>

<script>
// (JS éƒ¨åˆ†ç¶­æŒä¸è®Š)
const APP_URL = "https://script.google.com/macros/s/AKfycbyJADHe_DZdNIbfv_KPewAcBekEond-5Fw63i-RWCd1mHl_O9uGAQ-LTnzENZshjnhe/exec"; 
let rawData = [];
let selectedDates = new Set();

function getDayName(dateStr) {
  const days = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
  const safeStr = dateStr.replace(/\//g, '-');
  const d = new Date(safeStr);
  return days[d.getDay()] || '';
}

window.onload = function() {
  fetch(`${APP_URL}?action=getCourse`, { redirect: 'follow' })
    .then(res => res.json())
    .then(data => {
      rawData = data;
      const names = [...new Set(data.map(d => d['æŒ‡å°è€…']).filter(n => n && n !== "æŒ‡å°è€…"))].sort();
      document.getElementById('instructor').innerHTML = '<option value="">è«‹é»æ“Šé¸æ“‡</option>' + 
        names.map(n => `<option value="${n}">${n}</option>`).join('');
      document.getElementById('loading').style.display = 'none';
    });
};

document.getElementById('instructor').onchange = function() {
  selectedDates.clear(); refreshCourseList();
  const selIns = this.value;
  if (!selIns) { document.getElementById('dateGrid').innerHTML = ''; return; }
  const dates = [...new Set(rawData.filter(d => d['æŒ‡å°è€…'] === selIns).map(d => d['æ—¥æœŸ']))].sort();
  document.getElementById('dateGrid').innerHTML = dates.map(d => `
    <div class="date-item" onclick="toggleDate(this, '${d}')">
      <span class="day-name">${getDayName(d)}</span>
      <span class="date-val">${d.split('/').slice(1).join('/')}</span>
    </div>
  `).join('');
};

function toggleDate(el, date) {
  selectedDates.has(date) ? selectedDates.delete(date) : selectedDates.add(date);
  el.classList.toggle('active');
  refreshCourseList();
}

function refreshCourseList() {
  const listEl = document.getElementById('classList');
  listEl.innerHTML = '';
  if (selectedDates.size === 0) { document.getElementById('courseCard').style.display = 'none'; document.getElementById('submit').disabled = true; return; }
  document.getElementById('courseCard').style.display = 'block';
  const classes = rawData.filter(item => item['æŒ‡å°è€…'] === document.getElementById('instructor').value && selectedDates.has(item['æ—¥æœŸ']));
  classes.forEach(c => {
    const div = document.createElement('div');
    div.className = 'item';
    div.onclick = () => { const chk = div.querySelector('input'); chk.checked = !chk.checked; updateBtn(); };
    div.innerHTML = `
      <input type="checkbox" data-course="${c['èª²ç¨‹']}" data-date="${c['æ—¥æœŸ']}" data-time="${c['æ™‚é–“']}" onclick="event.stopPropagation(); updateBtn();">
      <div class="item-content">
        <div class="item-meta"><span>ğŸ“… ${c['æ—¥æœŸ']} (${getDayName(c['æ—¥æœŸ'])})</span><span>ğŸ•’ ${c['æ™‚é–“']}</span></div>
        <div class="item-title">${c['èª²ç¨‹']}</div>
      </div>`;
    listEl.appendChild(div);
  });
  updateBtn();
}

function updateBtn() { document.getElementById('submit').disabled = !document.getElementById('classList').querySelector('input:checked'); }

document.getElementById('submit').onclick = function() {
  this.disabled = true; this.textContent = 'æ­£åœ¨è™•ç†ç”³è«‹...';
  const items = [...document.getElementById('classList').querySelectorAll('input:checked')].map(cb => ({
    course_name: cb.dataset.course, start_time: cb.dataset.time, date: cb.dataset.date
  }));
  const params = new URLSearchParams({ instructor: document.getElementById('instructor').value, items: JSON.stringify(items) });
  fetch(`${APP_URL}?${params.toString()}`, { mode: "no-cors" })
    .then(() => { document.getElementById('modalOverlay').style.display = 'flex'; });
};
</script>
</body>
</html>
